generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AppConfiguration {
  id                  Int     @id @default(autoincrement())
  userId              Int?    @unique @map(name: "user_id")
  User                User?   @relation(fields: [userId], references: [id])
  totalUnit           String  @map(name: "total_unit")
  itemUnit            String  @map(name: "item_unit")
  lastList            Int?    @map(name: "last_list")
  idSequence          Int     @default(0) @map(name: "id_sequence")
  showSidebar         Boolean @default(true) @map(name: "show_sidebar")
  showImages          Boolean @default(false) @map(name: "show_images")
  showPrices          Boolean @default(false) @map(name: "show_prices")
  showWorn            Boolean @default(false) @map(name: "show_worn")
  showConsumable      Boolean @default(false) @map(name: "show_consumable")
  showListDescription Boolean @default(false) @map(name: "show_list_description")
  currencySymbol      String? @map(name: "currency_symbol")

  @@map(name: "app_configurations")
}

model Category {
  id                Int       @id @default(autoincrement())
  libraryId         Int       @map(name: "library_id")
  userId            Int?      @map(name: "user_id")
  user              User?     @relation(fields: [userId], references: [id])
  gearListLibraryId Int?      @map(name: "gear_list_library_id")
  gearList          GearList? @relation(fields: [userId, gearListLibraryId], references: [userId, libraryId])
  name              String

  subtotalWeight           Float @map(name: "subtotal_weight")
  subtotalWornWeight       Float @map(name: "subtotal_worn_weight")
  subtotalConsumableWeight Float @map(name: "subtotal_consumable_weight")
  subtotalPrice            Float @map(name: "subtotal_price")
  subtotalConsumablePrice  Float @map(name: "subtotal_consumable_price")
  subtotalQty              Int   @map(name: "subtotal_qty")

  categoryPosition CategoryPosition?
  items            ItemPosition[]

  @@unique([userId, libraryId])
  @@map(name: "categories")
}

model CategoryPosition {
  id                Int       @id @default(autoincrement())
  userId            Int?      @map(name: "user_id")
  user              User?     @relation(fields: [userId], references: [id])
  categoryLibraryId Int?      @map(name: "category_library_id")
  category          Category? @relation(fields: [categoryLibraryId, userId], references: [libraryId, userId])
  gearListLibraryId Int?      @map(name: "gear_list_library_id")
  gearList          GearList? @relation(fields: [gearListLibraryId, userId], references: [libraryId, userId])
  position          Int

  @@unique([userId, gearListLibraryId, categoryLibraryId])
  @@map(name: "category_positions")
}

model GearListPosition {
  id                Int       @id @default(autoincrement())
  gearListLibraryId Int?      @map(name: "gear_list_library_id")
  gearList          GearList? @relation(fields: [userId, gearListLibraryId], references: [userId, libraryId])
  userId            Int?      @map(name: "user_id")
  user              User?     @relation(fields: [userId], references: [id])
  position          Int

  @@unique([userId, gearListLibraryId], name: "gear_list_positions_user_id_gear_list_id_key")
  @@map(name: "gear_list_positions")
}

model GearList {
  id          Int     @id @default(autoincrement())
  libraryId   Int     @map(name: "library_id")
  userId      Int?    @map(name: "user_id")
  user        User?   @relation(fields: [userId], references: [id])
  externalId  String? @map(name: "external_id")
  name        String
  description String?

  totalWeight           Float @default(0.0) @map(name: "total_weight")
  totalWornWeight       Float @default(0.0) @map(name: "total_worn_weight")
  totalConsumableWeight Float @default(0.0) @map(name: "total_consumable_weight")
  totalBaseWeight       Float @default(0.0) @map(name: "total_base_weight")
  totalPackWeight       Float @default(0.0) @map(name: "total_pack_weight")
  totalPrice            Float @default(0.0) @map(name: "total_price")
  totalConsumablePrice  Float @default(0.0) @map(name: "total_consumable_price")
  totalQty              Int   @default(0) @map(name: "total_qty")

  categories        Category[]
  categoryPositions CategoryPosition[]
  gearListPosition  GearListPosition?

  @@unique([userId, libraryId])
  @@map(name: "gear_lists")
}

model ItemPosition {
  id                Int       @id @default(autoincrement())
  userId            Int?      @map(name: "user_id")
  user              User?     @relation(fields: [userId], references: [id])
  categoryLibraryId Int?      @map(name: "category_library_id")
  category          Category? @relation(fields: [userId, categoryLibraryId], references: [userId, libraryId])
  itemLibraryId     Int       @map(name: "item_library_id")
  position          Int
  item              Item      @relation(fields: [userId, itemLibraryId], references: [userId, libraryId])
  isWorn            Boolean   @default(false) @map(name: "is_worn")
  isConsumable      Boolean   @default(false) @map(name: "is_consumable")
  qty               Int       @default(1)
  star              Int       @default(0)

  @@unique([userId, categoryLibraryId, itemLibraryId])
  @@map(name: "item_positions")
}

model Item {
  id            Int            @id @default(autoincrement())
  libraryId     Int            @map(name: "library_id")
  userId        Int?           @map(name: "user_id")
  user          User?          @relation(fields: [userId], references: [id])
  name          String
  description   String?
  weight        Float          @default(0.00)
  weightUnit    String         @map(name: "weight_unit")
  price         Float          @default(0.00)
  imageUrl      String?        @map(name: "image_url")
  url           String?
  itemPositions ItemPosition[]

  @@unique([userId, libraryId])
  @@map(name: "items")
}

model User {
  id                Int                @id @default(autoincrement())
  username          String             @unique
  email             String
  passwordHash      String             @map(name: "password_hash")
  token             String?            @unique
  syncToken         Int?               @map(name: "sync_token")
  appConfiguration  AppConfiguration?
  gearListPositions GearListPosition[]
  gearLists         GearList[]
  items             Item[]

  @@map(name: "users")
  CategoryPosition CategoryPosition[]
  ItemPosition     ItemPosition[]
}
